#!/bin/bash

START_TIME=$SECONDS

process () {
    SCAD=$1
    BASE=${SCAD/%.scad/}
    DIR=$(dirname "$SCAD")

    mkdir -p "build/stl/$DIR"

    echo "  $SCAD..."
    LAST_LAP=$SECONDS
    openscad -o build/stl/$BASE.stl print/$SCAD
    echo "    $(($SECONDS - $LAST_LAP)) secs" && LAST_LAP=$SECONDS
}



echo ""
echo "# GATE"

process "gate/upright.scad"
process "gate/angle.scad"
process "gate/traverse.scad"

echo ""
echo "## Variant"

process "gate/variant/traverse_split_L.scad"
process "gate/variant/traverse_split_R.scad"

echo ""
process "gate/variant/traverse_without_basement.scad"
process "gate/variant/traverse_without_basement_split_L.scad"
process "gate/variant/traverse_without_basement_split_R.scad"

echo ""
echo "# BASEMENT"

process "basement/basement_block.scad"
process "basement/basement_box_bottom.scad"
process "basement/basement_box_side_slide.scad"
process "basement/basement_box_top.scad"

echo ""
echo "## Variant"

process "basement/variant/basement_block_with_hole.scad"
process "basement/variant/basement_box_top_without_hole.scad"



echo ""
echo "# GROUND"

process "ground/ground_basement_block.scad"
process "ground/ground_basement_box.scad"

echo ""
echo "## Variant"

process "ground/variant/ground_basement_block_with_hole.scad"
process "ground/variant/ground_basement_box_without_hole.scad"
process "ground/variant/ground_upright_with_hole.scad"
process "ground/variant/ground_upright_without_hole.scad"



echo ""
echo "# STARTLIGHTS"

process "startlights/startlights.scad"
process "startlights/hanger_clip.scad"
process "startlights/hanger_rod.scad"



echo ""
echo "DONE"
echo "   in $(($SECONDS - $START_TIME)) secs"
echo ""
